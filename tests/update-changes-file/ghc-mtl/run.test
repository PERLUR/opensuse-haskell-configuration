###############################################################################
# Verify that new changelogs are created properly.
###############################################################################

$$$ rm -f *.changes

$$$ ../../../tools/update-changes-file mtl 2.2 now
>>>= 0

$$$ cat ghc-mtl.changes
>>>
-------------------------------------------------------------------
now - psimons@suse.com

- Add mtl at version 2.2.
>>>= 0

###############################################################################
# Re-running the update with the same version has no effect.
###############################################################################

$$$ ../../../tools/update-changes-file mtl 2.2 now
>>>= 0

$$$ cat ghc-mtl.changes
>>>
-------------------------------------------------------------------
now - psimons@suse.com

- Add mtl at version 2.2.
>>>= 0

###############################################################################
# Now let's try an update.
###############################################################################

$$$ ../../../tools/update-changes-file mtl 2.2.0.1 now
>>>= 0
$$$ cat ghc-mtl.changes
>>>
-------------------------------------------------------------------
now - psimons@suse.com

- Update mtl to version 2.2.0.1.
  2.2.0.1
  -------
  * Fixed a bug caused by the change in how `transformers` 0.4 exports its data types. We will now export `runFooT` for each transformer again!

-------------------------------------------------------------------
now - psimons@suse.com

- Add mtl at version 2.2.
>>>= 0

###############################################################################
# Attempts to downgrade the version fail (without modifying the file)
###############################################################################

$$$ ../../../tools/update-changes-file mtl 2.2 now
>>>2
*** the diff contains an unexpected number of lines (-4)
>>>= 1
$$$ cat ghc-mtl.changes
>>>
-------------------------------------------------------------------
now - psimons@suse.com

- Update mtl to version 2.2.0.1.
  2.2.0.1
  -------
  * Fixed a bug caused by the change in how `transformers` 0.4 exports its data types. We will now export `runFooT` for each transformer again!

-------------------------------------------------------------------
now - psimons@suse.com

- Add mtl at version 2.2.
>>>= 0
